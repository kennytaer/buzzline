import{r as o,j as e}from"./index-C-5hEMXZ.js";import{u as C,a as D,F as N}from"./components-CcwgdvBG.js";function V(){const{orgId:F,existingCustomFields:w}=C(),s=D(),[g,v]=o.useState(""),[b,k]=o.useState(""),[p,x]=o.useState({}),[u,y]=o.useState(w||[]),[c,h]=o.useState({}),[f,m]=o.useState({}),S=t=>{var d;const n=(d=t.target.files)==null?void 0:d[0];if(n&&n.type==="text/csv"){const a=new FileReader;a.onload=r=>{var i;v((i=r.target)==null?void 0:i.result)},a.readAsText(n)}};return s&&"step"in s&&s.step==="complete"?e.jsx("div",{className:"px-4 py-6 sm:px-0",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-6",children:e.jsxs("div",{className:"flex",children:[e.jsx("svg",{className:"h-5 w-5 text-green-400 mt-1",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-lg font-medium text-green-800",children:"Import Successful!"}),e.jsxs("div",{className:"mt-2 text-sm text-green-700",children:[e.jsxs("p",{children:["Successfully processed ",s&&"totalRows"in s?s.totalRows:0," contacts:"]}),e.jsxs("ul",{className:"mt-2 space-y-1",children:[e.jsxs("li",{children:["• ",s&&"successfulRows"in s?s.successfulRows:0," new contacts imported"]}),s&&"duplicatesUpdated"in s&&s.duplicatesUpdated>0&&e.jsxs("li",{children:["• ",s&&"duplicatesUpdated"in s?s.duplicatesUpdated:0," duplicate contacts reactivated"]}),s&&"skippedDuplicates"in s&&s.skippedDuplicates>0&&e.jsxs("li",{children:["• ",s&&"skippedDuplicates"in s?s.skippedDuplicates:0," duplicate contacts skipped (already in list)"]}),s&&"failedRows"in s&&s.failedRows>0&&e.jsxs("li",{className:"text-yellow-700",children:["• ⚠️ ",s&&"failedRows"in s?s.failedRows:0," contacts failed to import"]})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx("a",{href:`/dashboard/contacts/segments/${s&&"listId"in s?s.listId:""}`,className:"text-green-800 hover:text-green-900 font-medium",children:"View segment →"})})]})]})})})}):s&&"step"in s&&s.step==="mapping"?e.jsx("div",{className:"px-4 py-6 sm:px-0",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900 mb-6",children:"Map CSV Columns"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Map your CSV columns to contact fields. Preview shows the first 5 rows."}),e.jsxs(N,{method:"post",children:[e.jsx("input",{type:"hidden",name:"step",value:"import"}),e.jsx("input",{type:"hidden",name:"csvContent",value:g}),e.jsx("input",{type:"hidden",name:"listName",value:b}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Map CSV Columns"}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:"For each CSV column, choose what field it should map to. You can use standard fields or create custom ones."}),e.jsx("div",{className:"space-y-4",children:s&&"headers"in s&&s.headers.map((t,n)=>{var d;return e.jsx("div",{className:"border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"CSV Column"}),e.jsx("div",{className:"px-3 py-2 bg-gray-100 border border-gray-200 rounded-md text-sm font-medium text-gray-900",children:t}),e.jsxs("div",{className:"mt-1 text-xs text-gray-500",children:["Sample: ",s&&"preview"in s&&((d=s.preview[0])==null?void 0:d[t])||"No data"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Maps to Field"}),e.jsxs("select",{className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 px-3 py-2",value:p[t]||"",onChange:a=>{if(a.target.value==="ADD_CUSTOM"){m(r=>({...r,[t]:!0}));return}x(r=>({...r,[t]:a.target.value})),m(r=>({...r,[t]:!1}))},children:[e.jsx("option",{value:"",children:"-- Select Field --"}),e.jsxs("optgroup",{label:"Standard Fields",children:[e.jsx("option",{value:"firstName",children:"First Name"}),e.jsx("option",{value:"lastName",children:"Last Name"}),e.jsx("option",{value:"email",children:"Email Address"}),e.jsx("option",{value:"phone",children:"Phone Number"})]}),u.length>0&&e.jsx("optgroup",{label:"Custom Fields",children:u.map(a=>e.jsx("option",{value:a,children:a},a))}),e.jsx("optgroup",{label:"Actions",children:e.jsx("option",{value:"ADD_CUSTOM",children:"+ Add Custom Field"})})]})]}),e.jsxs("div",{children:[f[t]&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"New Custom Field"}),e.jsxs("div",{className:"flex",children:[e.jsx("input",{type:"text",placeholder:"e.g., Vehicle Year, Job Title",className:"flex-1 rounded-l-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 px-3 py-2",value:c[t]||"",onChange:a=>h(r=>({...r,[t]:a.target.value})),onKeyDown:a=>{var r;if(a.key==="Enter"&&((r=c[t])!=null&&r.trim())){const i=c[t].trim();u.includes(i)||y(l=>[...l,i]),x(l=>({...l,[t]:i})),m(l=>({...l,[t]:!1})),h(l=>{const j={...l};return delete j[t],j})}}}),e.jsx("button",{type:"button",className:"px-3 py-2 border border-l-0 border-gray-300 bg-gray-50 text-gray-700 rounded-r-md hover:bg-gray-100 focus:outline-none focus:ring-1 focus:ring-primary-500 focus:border-primary-500",onClick:()=>{var a;if((a=c[t])!=null&&a.trim()){const r=c[t].trim();u.includes(r)||y(i=>[...i,r]),x(i=>({...i,[t]:r})),m(i=>({...i,[t]:!1})),h(i=>{const l={...i};return delete l[t],l})}},children:"Add"})]}),e.jsx("button",{type:"button",className:"mt-1 text-xs text-gray-600 hover:text-gray-800",onClick:()=>{m(a=>({...a,[t]:!1})),h(a=>{const r={...a};return delete r[t],r})},children:"Cancel"})]}),p[t]&&!f[t]&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Mapped Field"}),e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"flex-1 px-3 py-2 bg-green-50 border border-green-200 rounded-l-md text-sm font-medium text-green-800",children:["✓ ",p[t]]}),e.jsx("button",{type:"button",className:"px-3 py-2 border border-l-0 border-green-200 bg-red-50 text-red-700 rounded-r-md hover:bg-red-100 focus:outline-none focus:ring-1 focus:ring-red-500 focus:border-red-500",onClick:()=>{x(a=>{const r={...a};return delete r[t],r})},title:"Clear mapping",children:"−"})]})]})]})]})},t)})})]}),e.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Preview"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-300",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsx("tr",{children:s&&"headers"in s&&s.headers.map(t=>e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wide",children:t},t))})}),e.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:s&&"preview"in s&&s.preview.map((t,n)=>e.jsx("tr",{children:s&&"headers"in s&&s.headers.map(d=>e.jsx("td",{className:"whitespace-nowrap px-6 py-4 text-sm text-gray-900",children:t[d]},d))},n))})]})})]}),e.jsx("input",{type:"hidden",name:"mapping",value:JSON.stringify(p)}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:"Duplicate Handling"}),e.jsx("div",{className:"space-y-2",children:e.jsxs("label",{className:"flex items-start",children:[e.jsx("input",{type:"checkbox",name:"reactivateDuplicates",value:"true",className:"mt-0.5 h-4 w-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Reactivate opted-out duplicates"}),e.jsx("p",{className:"text-xs text-gray-500",children:"If a contact with the same email or phone already exists but has opted out, reactivate them when importing. Otherwise, duplicates will be updated but remain opted out."})]})]})})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("a",{href:"/dashboard/contacts/upload",className:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:"Back"}),e.jsx("button",{type:"submit",className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary-500 hover:bg-primary-600",children:"Import Contacts"})]})]})]})]})}):e.jsx("div",{className:"px-4 py-6 sm:px-0",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900 mb-6",children:"Upload Contacts"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Upload a CSV file to import your contacts. Make sure your CSV includes headers for proper field mapping."}),s&&"error"in s&&e.jsx("div",{className:"mb-6 bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("p",{className:"text-red-800",children:s.error})}),e.jsxs(N,{method:"post",className:"space-y-6",children:[e.jsx("input",{type:"hidden",name:"step",value:"preview"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Contact List Name"}),e.jsx("input",{type:"text",name:"listName",value:b,onChange:t=>k(t.target.value),className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 px-3 py-2",placeholder:"e.g., Newsletter Subscribers",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"CSV File"}),e.jsx("input",{type:"file",accept:".csv",onChange:S,className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-medium file:bg-primary-50 file:text-primary-700 hover:file:bg-primary-100",required:!0}),e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Upload a CSV file with contact information. Common columns include: Name, Email, Phone, Company, etc."})]}),e.jsx("input",{type:"hidden",name:"csvContent",value:g}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",disabled:!g||!b,className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary-500 hover:bg-primary-600 disabled:bg-gray-400 disabled:cursor-not-allowed",children:"Preview Import"})})]}),e.jsxs("div",{className:"mt-8 p-4 bg-primary-50 rounded-lg",children:[e.jsx("h3",{className:"text-sm font-medium text-primary-900 mb-2",children:"Need a template?"}),e.jsx("p",{className:"text-sm text-primary-700 mb-3",children:"Download a sample CSV template with common fields to get started quickly."}),e.jsxs("button",{type:"button",className:"inline-flex items-center px-3 py-2 border border-primary-300 shadow-sm text-sm font-medium rounded-md text-primary-700 bg-white hover:bg-primary-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",onClick:()=>{const t=`First Name,Last Name,Email,Phone,Company,Notes
John,Doe,john@example.com,+15551234567,Acme Corp,Sample contact
Jane,Smith,jane@example.com,+15559876543,Tech Inc,Another sample`,n=new Blob([t],{type:"text/csv"}),d=window.URL.createObjectURL(n),a=document.createElement("a");a.href=d,a.download="contacts-template.csv",document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(d)},children:[e.jsx("svg",{className:"-ml-1 mr-2 h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Download Template CSV"]})]})]})})}export{V as default};
